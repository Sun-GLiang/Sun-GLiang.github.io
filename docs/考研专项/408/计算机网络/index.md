# 计算机网络

## 第1章 计算机网络体系

- 区分**传输时延**和**传播时延**：传播时延与传播介质、通信双方距离有关
    - 电路交换：传输时延小，但是不能保证数据无差错的传送
    - 报文交换和分组交换：传输时延大；分组交换的传输时延又小于报文交换
- 注意单位：B和b的转换
- 主机A给主机B发送数据的最高理论速率取决于：链路带宽、主机A的网卡速率、主机B的网卡速率中的最小者，是数据传输的瓶颈
- 网络协议三要素
    - 语法：数据与控制信息的格式（如何讲：传输数据的格式）
    > 例如：IPv4数据报的首部格式、TCP报文段格式
    - 语义：需要发出何种控制信息、完成何种动作、做出何种应答（讲什么：所要完成的功能）
    > 例如：TCP连接的三次握手时所执行的操作
    - 时序：执行各种操作的条件、时序关系等，即事件实现顺序的说明（信息交流的次序）
    > 例如：TCP连接的三次握手的时序关系
- 物理层只负责透明传输比特，不涉及流量控制的功能
- 网络层和传输层才有拥塞控制功能
- 数据链路层向上提供可靠的传输服务，保证了数据正确的顺序和完整性
- 会话层使用**检验点**使通信会话在通信失效时从检验点继续恢复通信，实现数据同步
- 表示层负责数据格式转换、数据加密解密
- 为网络层实体提供数据发送和接收功能及过程的是数据链路层
  > 下一层为上一层提供服务
- 各层的SAP说明（N层的SAP是N+1层可以访问N层服务的地方
    - 数据链路层的SAP是帧的“类型”字段（由LLC子层实现）
    - 网络层的SAP是IP数据报的“协议”字段
    - 传输层的SAP是“端口号”字段
    - 应用层的SAP是用户接口



## 物理层

- $比特率 = 波特率 * log_2 n$，n表示码元的不同的离散值
- 曼彻斯特编码的效率是50%
  > 波特率 = 比特率 * 2
- 每秒采样$N$次，表示频率是$N$ HZ。
    - 采样定理：采样率需要大于等于有效信号最高频率或其带宽的2倍
    - 波特率的上限是2W（无噪声下，奈奎斯特定理）
    - 若每秒采样次数大于2W，则该信息无意义，不能用于计算
    - 若给定的未给频率（即$W$），只给出采样率，则最大数据传输速率为$采样率*log_2 V$
      > 是否是因为`采样率=2W`？？？
    - 若只给定频率，未说明是否无噪声，但是又给出编码信息，则利用**采样率至少是最大频率的2倍**，计算最大数据传输速率为$采样率*log_2 V$
- 编码
    - RN：归零编码
    - NRZ：非归零编码
    - NRZI：反向非归零编码（翻转为0，不变为1
- 香农定理：$Wlog_2 (1+S/N)$，其中$分贝数=10log_10 S/N$
- 题中同时出现奈奎斯特定理、香农定理，则数据传输速率取其最小值
    - 若给出的**码元数与比特数之间的关系**、**信噪比**，则同时受到二者约束
    - ??? success "二进制信号在信噪比为127:1的4kHZ信道上传输，最大数据传输速率可以达到多少？"
        <br></br>
        **分析**：由于给定了`二进制信号`，则说明有两个电平的变化，所用编码为1bit，即$log_2 V=1$，由曼彻斯特编码$2Wlog_2 V$可知，数据传输率为8kb/s；又由于给定`信噪比`，则由香农定理，有$Wlog_2 (1+S/N)$，其中$S/N=127$，计算得28kb/s。取最小值，为8kb/s
??? note "补充"
    ![](./imgs/0.jpg)
    1路信号的最大频率为1kHz，则采样率至少是2kHz，同时编码为4位二进制数，因此1路最大数据传输率为$2k*4=8kb/s$。又由于**复用的每条支路的数字信号速率要相等**，而另外7路数字信号的速率均低于8kb/s，所以它们要采用脉冲填充方式，将数据率提高到8kb/s。然后复用这8路信号。复用线路需要的最小通信能力是$8kb/s*8=64kb/s$

- 转发器是物理层设备，只具有放大信号的功能
- 两个网段在物理层进行互连时，要求：**数据传输速率要相同**，但是数据链路层协议可以不同（前提是不进行链路层是互联互通。如果要达到在链路层的互联互通，则要求数据传输速率和数据链路层协议都要相同）
    - ![](./imgs/1.jpg)


## 数据链路层

- 数据链路层的功能：组帧（帧定界）、帧在物理信道的传输（处理差错传输）（差错检验）、数据链路的建立维护和释放（链路管理）、帧的传输速率（流量控制）、提供结点间的可靠传输、控制对物理传输介质的访问（由介质访问控制MAC子层完成）
  > 为终端结点隐藏物理传输细节是物理层的功能
- 为避免传输过程帧丢失，采用*计时器超时重发*；为保证接收方不会收到重复帧，采用*帧编号机制*


**停止等待、BGN、SR协议**

- 当源主机和目的主机之间的距离很远，且数据传输速率很高时，停止等待协议的效率变得非常低
  > $信道利用率=\frac{发送数据所需的时间（大于等于一个数据帧）（准确来讲分子应该是发送窗口大小*一个数据帧的发送时间）}{发送周期}$，其中**发送周期=<font color="red">发送一个数据帧所需的时间</font>+往返时延+确认帧的发送时延**（即从开始发送数据帧到接收到第一个数据帧的确认帧为止）。因此，当数据传输率很高，则数据的发送时间就很短，而源主机和目的主机的距离很远时，往返时延就很高，最终导致信道利用率很低
  > 由公式可知，数据帧长越大，信道利用率越高
- 若连续出现了相同序号的数据帧，则发送方超时重传；若连续出现了相同序号的确认帧，则接收方收到了重复帧
- 停止等待协议，每发送完一个帧，就要停下来等待接收方发回确认帧，收到确认帧才能发送下一帧，经过超时时间后未收到ACK帧则自动重传
- SR协议中，接收方对正确收到的每个数据帧单独进行确认，不要求收到的数据帧是有序的。只要没有发生超时，发送方就不进行重传
- GBN协议中，接收方采用累计确认的方式，接收方检测到某个帧出错时，会简单丢弃该帧及所有的后续帧，发送方超时后，需要重传该数据帧及所有的后续帧
- 滑动窗口协议中，序列号个数要大于等于窗口数（**发送窗口+接收窗口**）
- 对于窗口大小为n的滑动窗口，最多可以有$n-1$帧已发送但是没有确认
  > 对于**窗口大小**为n的滑动窗口，其发送窗口最大为n-1，所以最多可以有n-1帧已发送但是没有确认
  > 确认**窗口大小**时，时刻牢记**窗口大小=发送窗口+接收窗口**，以此计算序列号
- SR协议中，对窗口大小的规定
  - $发送窗口\geq  接收窗口$
  - $发送窗口+接收窗口\leq 2^n$
  - $接收窗口\leq 2^{n-1}$
  - 发送窗口的大小可以大于$2^{n-1}$
  > 之前一直是搞错的状态
- 为了使信道利用率达到最大（100%），需要让发送方在发送周期内持续发送数据帧，直到发送方接收到所发的第一个数据帧的确认帧为止
  > BGN和SR协议都可能达到100%，只要发送窗口足够大
  > **最大的数据传输率一定是小于等于信道带宽的**
- 简单来讲，信道利用率=$\frac{发送窗口大小*发送一个数据帧的时间}{一个数据帧的发送周期}$








## 传输层

### TCP

**TCP使用选择重传**

- A发送了N个报文段，其中第k个报文段丢失，其余N-1个报文段正确按序到达接收方B
    > 使用GBN时，A需要重传分组k以及所有后继分组k+1,k+2,...,N
    > 而TCP至多只需要重传一个报文段，即报文段k














## 应用层


### 不同应用层协议<font color="red">服务器端</font>使用的端口及传输层协议


指的是<font color="red">服务器端</font>的端口

| 应用层 | FTP控制连接 | FTP数据连接 | DNS | HTTP | SMTP | POP3 |
| ------ | ----------- | ----------- | --- | ---- | ---- | ---- |
| 协议   | TCP         | TCP         | UDP | TCP  | TCP  | TCP  |
| 端口号 | 21          | 20          | 53  | 80   | 25   | 110  |


### DNS

- 域名不区分大小写

- 域名向IP地址的转换
    > 形如y.ab.com，客户机为查询得到其IP地址，整个过程共需要发送8个UDP报文段：4个查询报文（第一次是客户机发送，其他三次都是本地域名服务器发送）、4个回答报文
    >> 但是若问到，本地域名服务器时，则当前只发送了3次查询报文

### FTP

- 交互式访问

- 允许客户指明文件类型、格式，允许文件有存储权限

- 在异构网络中的任何计算机之间传送文件

- C/S模式：一个服务器，多个客户进程
    - 服务器进程由两个部分组成：主进程（接收新的请求）、若干从属进程（处理单个请求）；二者间并发进行
        - 服务器必须追踪用户在远程目录树上的位置

- 控制连接：在会话期间一直存在

- 数据连接：数据传送完就关闭连接
    - 主动模式：服务器连接到客户端（客户端主动告诉服务器开放哪个端口）
    - 被动模式：客户端连接到服务器（客户端让服务器打开服务器的某个端口，然后客户端连接这个端口）

- 控制信息是外带传送的（分离的控制连接）



### 电子邮件

**发送邮件过程**

用户->(SMTP、TCP)邮件服务器->(SMTP、TCP)邮件服务器->(POP3或IMAP、TCP)用户代理

**MIME**

SMTP只能发送7位ASCII码，通过MIME，就可以将非ASCII码转化为ASCII码，再交由SMTP进行传送

**POP3**

- 接收方的邮件服务器中运行POP服务器程序，接收方的用户代理必须允许POP客户程序

### HTTP

- cookie可以在无状态的HTTP之上建立一个用户会话层

- HTTP是无状态的：同一个客户第二次访问同一个网站，服务器的响应与第一次相同

- HTTP是无连接的：通信双方在交换HTTP报文之前不需要先建立HTTP连接

- 连接方式
    - 非持续连接（HTTP/1.0）

    - 持续连接（HTTP/1.1）
        - 非流水线方式：每次请求一个对象，1个RTT
        - 流水线方式：请求所有对象，近乎1个RTT

- HTTP请求报文中常用的几个方法
    - GET：请求读取由URL标识的信息
    - HEAD：请求读取由URL标识的信息的首部
    - POST：给服务器添加信息（如注释）
    - CONNECT：代理服务器


